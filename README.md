## RU

# Airbnb парсер

**Что делает:** Парсер данных сайта Airbnb на python библиотеках Beautiful Soup 4 и Selenium. Собранные данные размещает в реляционной базе данных PostgreSQL. Так же задумана аналитика данных.

**Готовность:** Собирает, вносит в базу, бот выдает в таблице банные, фильтры, статистика.

**Как запустить:** Сейчас, запускается docker-compose - база данных Postgresql. И просто запускается файлы python: parser_list.py - парсер списков id  url, parser_object.py - парсер объекта, bot.py - запуск телеграмм бота. Для запуска:

- Установить google chrome, docker, docker-compose

- Колонировать репозиторий

- Установить виртуальное окружение в эту папку, запустить

- Создать в корне папки файл .env заполнить его по аналогии с файлом example-env, т. е. придумать имя пользователя и пароль базы данных.

- В файле Dockerfile все раскоментировать - это установить все библиотеки через pip при запуске контейнера.

- При деплое на сервер, нужно изменить имя файла "pg_hba.conf-ex" на имя - "pg_hba.conf". Этот файл запрещает доступ к базе акромя локали.

- Поднять docker-compose up --build. Установятся связи. Запуститься база.

- И просто запускается файлы python: parser_list.py - парсер списков id  url, parser_object.py - парсер объекта, bot.py - запуск телеграмм бота.

- В идеале, в конечной настройке в деплой, нужно пометить в docker-compose еще 3 сервиса, к имеющемуся postgresql. А именно - сервис парсера списков, сервис парсера объектов, сервис бота. И при запуске докера все само запускается. 

Пример окна бота:

<img src="https://raw.githubusercontent.com/shliamb/airbnb/main/img/9.png?token=GHSAT0AAAAAACQOLXF5CRSH57MEHFIBQA6CZRAI4AQ" alt="Airbnb" width="auto" height="auto" align="top">


Сайт Airbnb кусается. При длительном парсинге страниц, блокируется доступ к сайту. Решилось автоматическим удалением и созданием новых профилей браузера.

<img src="https://raw.githubusercontent.com/shliamb/airbnb/main/img/5.png?token=GHSAT0AAAAAACQOLXF4PTF7O3VDYCGSBZMSZRAI6GA" alt="Airbnb" width="auto" height="auto" align="top">


- После доработок работы парсера, ошибок не возникает и сервер максимально отзывчев. Обращение не блокирует, даже, если довольно долго его парсить. Хотя почти везде установлены случайные задержки в дробных числах. Так же заморочился с подменой user-agent, максимально-возможно скрыл доступные способы скрытия фингерпринта железа. 10 профилей, хоть и пустых chrome driver. При необходимости, можно будет подразвить и вообще подключить proxy. Но я не думаю, что в ближайшее время сервер доростет до борьбы с этим парсером, посмотрим. Так же есть возможность использовать режим драйвера хрома headless. Браузер не будет запускаться до конца, т. е. не будет визуальной части браузера, головы, но все будет работать и нормально парсить.
